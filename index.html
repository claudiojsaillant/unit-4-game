<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>
    <h1 id="gametitle">Star Wars Game</h1>
    <h2 id="message"></h2>
    <div class="container">
        <h2 id="character"></h2>
        <div class="row" id="row1">

            <div class="img character" id="img1" value="character">
                <p id="name1">name</p>
                <img id="one" src="" alt="">
                <p id="hp1">number</p>
            </div>
            <div class="img character" id="img2" value="character">
                <p id="name2">name</p>
                <img id="two" src="" alt="">
                <p id="hp2">number</p>
            </div>
            <div class="img character" id="img3" value="character">
                <p id="name3">name</p>
                <img id="three" src="" alt="">
                <p id="hp3">number</p>
            </div>

            <div class="img character" id="img4" value="character">
                <p id="name4">name</p>
                <img id="four" src="" alt="">
                <p id="hp4">number</p>
            </div>

        </div>
        <p>Attacking</p>
        <div class="row" id="row2">

        </div>
        <div class="row">
            <button type="button" class="btn btn-danger" id="attackButton">Attack</button>
        </div>
        <p>Defense position</p>
        <div class="row" id="row3">

        </div>
    </div>



    <script type="text/javascript">

        var posiblePicks = ['img1', 'img2', 'img3', 'img4'];
        var character;
        var actualEnemy;
        var waiting = [];
        var characterHP = '';
        var enemyHP = '';
        var enemyAttack = '';
        var characterAttack = '';
        var attacking = [];

        let audioLose = document.createElement("audio");
        audioLose.setAttribute("src", "assets/sounds/lose.mp3");
        let audioWin = document.createElement("audio");
        audioWin.setAttribute("src", "assets/sounds/win.mp3");
        let audioAttack = document.createElement("audio");
        audioAttack.setAttribute("src", "assets/sounds/attack.mp3");
        // for lose/win

        var defeated = 0;

        //Object

        var gameObject = {
            characters: [{
                hpp: '#hp1',
                pname: '#name1',
                name: "Obi-Wan Kenobi",
                attack: 6,
                hp: 150,
                increaseAttack: 6,
                imgSource: "assets/images/ayuwoki.jpg",
                value: '1',
                divid: "#img1",
                imgid: "#one",
            },
            {
                hpp: '#hp2',
                pname: '#name2',
                name: "Dark Vader",
                attack: 8,
                hp: 140,
                increaseAttack: 5,
                imgSource: "assets/images/madonna.jpg",
                value: '2',
                divid: "#img2",
                imgid: "#two"
            },
            {
                hpp: '#hp3',
                pname: '#name3',
                name: "Luke Skywalker",
                attack: 8,
                hp: 110,
                increaseAttack: 6,
                imgSource: "assets/images/seventies.jpg",
                value: '3',
                divid: "#img3",
                imgid: "#three"
            },
            {
                hpp: '#hp4',
                pname: '#name4',
                name: "Master Yoda",
                attack: 9,
                hp: 130,
                increaseAttack: 5.5,
                imgSource: "assets/images/hangman.png",
                value: '4',
                divid: "#img4",
                imgid: "#four"
            }]
        }

        function insideCharacter(array) {
            for (i = 0; i < array.length; i++) {
                var indexArray = '#' + array[i];
                $("#row2").append($(indexArray));
                $(indexArray).removeClass("character").addClass("enemy");
                $(indexArray).attr('value', 'enemy');
            }
        };

        function insideEnemy(array) {
            for (i = 0; i < array.length; i++) {
                var indexArray = '#' + array[i];
                $("#row3").append($(indexArray));
                $(indexArray).removeClass("enemy").addClass("waiting");
                $(indexArray).attr('value', 'waiting');
            }
        };

        function elementGenerator() {
            gameObject.characters.forEach(element => {
                //Images
                var src = $(element.imgid).attr('src', element.imgSource);
                src = element.imgSource;

                //Name
                $(element.pname).text(element.name);

                //hp
                $(element.hpp).text(element.hp);

            });
        };

        function attack() {

            gameObject.characters.forEach(element => {
                if (element.divid.includes(character)) {
                    characterHP = element.hp;
                    characterAttack = element.attack;
                    element.attack = element.attack + element.increaseAttack;
                }
                if (element.divid.includes(actualEnemy)) {

                    enemyHP = element.hp;
                    enemyAttack = element.attack;
                }
            });

            gameObject.characters.forEach(element => {
                if (element.divid.includes(character)) {
                    element.hp = element.hp - enemyAttack;
                    console.log(element.hp)
                    if (element.hp < 0) {
                        characterElement = '#' + character;
                        $(characterElement).remove();
                        audioLose.play();
                        $('#message').text('You lost the game!')
                    }
                }
                if (element.divid.includes(actualEnemy)) {
                    element.hp = element.hp - characterAttack;
                    if (element.hp < 0) {
                        enemyElement = '#' + actualEnemy;
                        $(enemyElement).remove();
                        defeated++;
                        if (defeated === 3) {
                            audioWin.play();
                            $('#message').text('You won the game!')
                        }
                    }
                }
            })
            elementGenerator();

        }



        $('.character').on('click', function () {

            if ($(this).attr('value') === 'character') {
                character = $(this).attr('id');
                var newArray = function (posibleNums) {
                    return posibleNums != character
                }
                posiblePicks = posiblePicks.filter(newArray);
                insideCharacter(posiblePicks);
            }
            else if ($(this).attr('value') === 'enemy') {
                actualEnemy = $(this).attr('id');
                var newArray = function (posibleNums) {
                    return posibleNums != actualEnemy;
                }
                posiblePicks = posiblePicks.filter(newArray);
                insideEnemy(posiblePicks);
            }

            else if ($(this).attr('value') === 'waiting') {
                $(this).attr('value', 'enemy');
                $("#row2").append($(this));
                $(this).removeClass("waiting").addClass("enemy");
                actualEnemy = $(this).attr('id');
            }

        });


        $('#attackButton').on('click', function () {

            audioAttack.play();
            attack();

        })

        elementGenerator();


    </script>
</body>

</html>